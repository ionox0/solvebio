!function(){angular.module("App.Genes",[]);angular.module("App",["ngRoute","App.Genes"])}(),!function(){angular.module("App").factory("d3Service",["$document","$q","$rootScope",function(t,e,n){function r(){n.$apply(function(){a.resolve(window.d3)})}var a=e.defer(),i=t[0].createElement("script");i.type="text/javascript",i.async=!0,i.src="http://d3js.org/d3.v3.min.js",i.onreadystatechange=function(){"complete"==this.readyState&&r()},i.onload=r;var o=t[0].getElementsByTagName("body")[0];return o.appendChild(i),{d3:function(){return a.promise}}}])}(),!function(){angular.module("App.Genes").service("geneService",["$q","$http",function(t,e){var n="https://api.solvebio.com/v1/datasets/ISCN/1.1.0-2015-01-05/Ideograms/data?access_token=98e8f6ba570311e4bab59f6dc3060e21",r=function(r){var a=t.defer(),i=n+r;return e.get(i).success(function(t){a.resolve(t)}).error(function(t){a.reject(t)}),a.promise},a=function(n){var r=t.defer(),a="https://api.solvebio.com/v1/datasets/115/data",i={fields:["arm","band_label","genomic_coordinates.start","genomic_coordinates.stop","density"],filters:[{and:[["genomic_coordinates.chromosome",n],["band_level","550"]]}]},o={method:"POST",url:a,headers:"JWT eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Imlvbm94MEBnbWFpbC5jb20iLCJkb21haW4iOiJpYW4tam9obnNvbiIsImlzX3N0YWZmIjpmYWxzZSwidXNlcl9pZCI6MTcxOSwiZXhwIjoxNDU5Njk3NDQ0LCJmbGFncyI6e30sInJvbGUiOiJwcmltYXJ5X293bmVyIiwiaXNfdmVyaWZpZWQiOmZhbHNlLCJlbWFpbCI6Imlvbm94MEBnbWFpbC5jb20iLCJwZXJtaXNzaW9ucyI6WyJhY2NvdW50cy52aWV3X2JpbGxpbmciLCJhY2NvdW50cy5jYW5fc2VuZF9pbnZpdGVzIiwiYWNjb3VudHMuZWRpdF9zZXR0aW5ncyIsImFjY291bnRzLnZpZXdfc2V0dGluZ3MiLCJhY2NvdW50cy5lZGl0X2F1dGhfc2V0dGluZ3MiLCJhY2NvdW50cy5jYW5fcG9zdF9wdXRfcGF0Y2giLCJhY2NvdW50cy5jYW5fbWFuYWdlX2NyZWRlbnRpYWxzIiwiYWNjb3VudHMubWFuYWdlX21lbWJlcnMiLCJhY2NvdW50cy5hc3NpZ25fcHJpbWFyeV9vd25lciIsImFjY291bnRzLnZpZXdfbWVtYmVycyIsImFjY291bnRzLmFjY2Vzc19hcGkiLCJhY2NvdW50cy5lZGl0X2JpbGxpbmciXX0.a-99IQ1Pz1xmdI5GP8As9KAkc_sxsugwKrnLduuFr1o",data:i};return e(o).success(function(t){r.resolve(t)}).error(function(t){console.log(t)}),r.promise};return{getGeneData:r,getIdeogramData:a}}])}(),angular.module("App").directive("ideogram",["$window","d3Service",function(t,e){return{scope:{geneData:"="},link:function(n,r){function i(t){return u*t/l}function o(t,e){return u*(e-t)/l}function c(t,e,n,r,i){return a="M"+(t+n)+","+e+"h"+(i-n)+"a"+i+","+i+" 0 0 0 "+-i+","+i+"v"+(r-2*i)+"a"+i+","+i+" 0 0 0 "+i+","+i+"h"+(n-i)+"z",a}function s(t,e,n,r,i){return a="M"+t+","+e+"h"+(n-i)+"a"+i+","+i+" 0 0 1 "+i+","+i+"v"+(r-2*i)+"a"+i+","+i+" 0 0 1 "+-i+","+i+"h"+(i-n)+"z",a}var u=angular.element(t)[0].innerWidth;window.onresize=function(){n.$apply()},n.$watch(function(){return angular.element(t)[0].innerWidth},function(){m()}),n.$watch(function(){return n.geneData},function(){f(n.geneData)});var d=d3.select(r[0]).append("svg").style("width","100%"),l=26e7,p="genomic_coordinates",f=function(t){var n=t.results,r=n.filter(function(t){return"p"===t.arm}),a=n.filter(function(t){return"q"===t.arm}),u=Math.min.apply(Math,r.map(function(t){return t[p].start})),l=n.find(function(t){return t[p].start==u}),f=Math.max.apply(Math,r.map(function(t){return t[p].stop})),m=n.find(function(t){return t[p].stop==f}),h=Math.min.apply(Math,a.map(function(t){return t[p].stop})),g=n.find(function(t){return t[p].stop==h}),b=Math.max.apply(Math,a.map(function(t){return t[p].stop})),v=n.find(function(t){return t[p].stop==b});n.splice(n.indexOf(l),1),n.splice(n.indexOf(m),1),n.splice(n.indexOf(g),1),n.splice(n.indexOf(v),1);var y=25,W=50;e.d3().then(function(){d.selectAll("rect").remove(),d.selectAll("path").remove(),d.selectAll("rect").data(n).enter().append("rect").attr("x",function(t){return i(t[p].start)}).attr("width",function(t){return o(t[p].start,t[p].stop)}).attr("y",y).attr("height",W).attr("stroke","white").attr("stroke-width",1).attr("fill",function(t){return"rgb(0,0,"+t.density+")"}),d.append("path").attr("d",c(i(l[p].start),y,o(l[p].start,l[p].stop),W,10)).attr("stroke","white").attr("stroke-width",1).attr("fill",function(t){return"rgb(0,0,"+l.density+")"}),d.append("path").attr("d",s(i(m[p].start),y,o(m[p].start,m[p].stop),W,10)).attr("stroke","white").attr("stroke-width",1).attr("fill",function(t){return"rgb(0,0,"+m.density+")"}),d.append("path").attr("d",c(i(g[p].start),y,o(g[p].start,g[p].stop),W,10)).attr("stroke","white").attr("stroke-width",1).attr("fill",function(){return"rgb(0,0,"+g.density+")"}),d.append("path").attr("d",s(i(v[p].start),y,o(v[p].start,v[p].stop),W,10)).attr("stroke","white").attr("stroke-width",1).attr("fill",function(){return"rgb(0,0,"+v.density+")"})})},m=function(){u=angular.element(t)[0].innerWidth,d.selectAll("rect").attr("x",function(t){return i(t[p].start)}).attr("width",function(t){return o(t[p].start,t[p].stop)})}}}}]),!function(){angular.module("App.Genes").controller("genesCtrl",["geneService","d3Service",function(t,e){function n(){r.genesList=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","x","y"],r.selectedGene=r.genesList[0],r.chooseGene()}var r=this;r.chooseGene=function(e){t.getIdeogramData(e).then(function(t){r.geneData=t})},n()}])}(),!function(){angular.module("App.Genes").config(["$routeProvider",function(t){t.when("/genes",{templateUrl:"templates/genes_template.html",controller:"genesCtrl",controllerAs:"ctrl"}).otherwise({redirectTo:"/genes"})}])}();